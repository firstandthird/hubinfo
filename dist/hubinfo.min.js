/*
  * hubInfo - a github repo widget 
  * v0.1.2
  * https://github.com/jgallen23/hubinfo
  * copyright JGA 2012
  * MIT License
  */
!function(e){var t=function(t,n,r){e.ajax({url:"https://api.github.com/repos/"+t+"/"+n,dataType:"jsonp",success:function(e){if(e.data.message=="Not Found")throw new Error("Invalid user or repo");r(e.data)}})},n=function(t,n,r,i){e.ajax({url:"https://api.github.com/repos/"+t+"/"+n+"/commits",dataType:"jsonp",success:function(e){var t=e.data.slice(0,r);i(t)}})},r=function(e,r,i,s){var o=0,u=2,a,f,l=function(){o==u&&s(a,f)};t(e,r,function(e){o++,a=e,l()}),n(e,r,i,function(e){o++,f=e,l()})},i=function(e){if(typeof e=="string"){var t=e.split("T")[0].split("-");e=new Date(t[0],t[1]-1,t[2])}var n=(new Date).getTime(),r=n-e.getTime(),i=r/1e3,s=Math.floor(r/864e5);return s===0?"today":s>30?Math.floor(s/30)+" month(s) ago":s+" day(s) ago"};e.fn.hubInfo=function(t){var n=e.extend({},e.fn.hubInfo.defaults,t),s=this;return r(n.user,n.repo,n.nbCommits,function(t,r){n.debug&&console.log(arguments),s.each(function(s,o){var u=e(n.template);u.find(".repo-lang").html(t.language).end().find(".repo-watchers").html(t.watchers).attr("href",t.html_url).end().find(".repo-forks").html(t.forks).attr("href",t.html_url).end().find(".repo-name").html(t.name).attr("href",t.html_url).end();for(var a in r){var f=r[a];u.find(".repo-commits").append('<a class="repo-commit-message nb'+a+'"></a>').append('<div class="repo-commit-date nb'+a+'">committed <span></span></div>').end().find(".repo-commit-message.nb"+a).html(f.commit.message).attr("href","https://github.com/"+n.user+"/"+n.repo+"/commit/"+f.sha).end().find(".repo-commit-date.nb"+a+" span").html(i(f.commit.committer.date)).end()}var l=e(o);l.html(u),l.trigger("render")})}),s},e.fn.hubInfo.defaults={user:"",repo:"",nbCommits:1,debug:!1,template:['<div class="github-repo">','<div class="repo-header">','<div class="repo-stats">','<span class="repo-lang"></span>','<a class="repo-watchers"></a>','<a class="repo-forks"></a>',"</div>","<div>",'<a class="repo-name"></a>',"</div>","</div>",'<div class="repo-commits"></div>',"</div>"].join("")}}(jQuery)